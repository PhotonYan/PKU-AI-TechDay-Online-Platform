# 管理员使用指南

面向拥有 `admin` 角色的用户，帮助快速掌握后台配置、审批、数据库维护与奖项分发功能。

## 1. 登录与基础信息
- 默认账号：`admin@techday.local / AdminPass123`，首次启动自动写入，可在 `.env`（或环境变量 `ADMIN_EMAIL`/`ADMIN_PASSWORD`）中覆盖。
- 登录后导航栏会出现“报销管理 / 后台管理 / 参展管理 / 数据库 / 奖项管理”等入口；点击右上角头像可跳转志愿者信息页（部分数据与普通志愿者一致）。

## 2. 报销审批
- 页面：`报销管理`（`/reimbursements`）。
- 能力：
  - 查看所有人的申请，按状态分栏。
  - 点击单条记录可展开详情、下载附件。
  - “审批”按钮可将状态改为 `通过 / 拒绝 / 等待补充`。
  - 右上角“导出报销”会触发 `GET /api/reimbursements/export/csv`，生成全量 CSV。
- 小贴士：志愿者只能操作自己的报销，因此管理员可以直接在此页帮忙纠错、删除。

## 3. 后台管理（`/admin/settings`）
模块按卡片拆分，核心能力如下：

| 区块 | 功能 |
| --- | --- |
| 组织管理 | 创建/编辑多级组织（比如“学术组”“场务组”），填写职责说明，供报名表和报销下拉使用。 |
| 角色模板 | 定义模板名称与“是否允许编辑投票数据”标记，稍后可分配给用户。 |
| 审稿方向 | 管理 `Direction`，作者投稿和审阅者注册都会引用，删除需保证无投稿关联。 |
| 用户列表 | 过滤+内联编辑组织/模板/角色/计票意愿；右上角可导出当前用户 CSV。 |
| 投票展示设置 | 控制成果页是否显示投票、是否允许按投票排序、哪一个模板可编辑投票、公开显示哪些奖项标签。 |
| 审阅者邀请码 | 生成 8 位邀请码，可选预设方向；未使用前可删除。 |
| 奖项定义 | 新增/编辑奖项名称、描述、色彩，供后续奖项面板引用。 |

保存设置后立即生效，所有调用均走 `/api/admin/*` 系列接口。

## 4. 参展管理（`/admin/exhibits`）
- 支持按 Track（Poster/Demo）与年份筛选；默认显示当年投稿。选择“全部年份”时，序号会以 `YY-序号` 的格式展示，方便区分不同年份。
- 可执行：`通过` / `未通过` 审核、删除投稿、重新编号。重新编号会在所选年份内按投稿创建时间重新赋值；若在“全部年份”下操作，会分别对每一年独立从 1 开始编号。
- “查看详情”会跳到公开 `papers/:id` 页面，方便核对展示内容。

## 5. 奖项管理（管理员视角）
- 页面：`/awards`，同样支持 Track + 年份 + 状态 + 方向多维过滤；“全部年份”下的序号会展示为 `YY-序号`。
- 筛选条件：Track、排序（序号/ID）、按状态或方向过滤。管理员可以多选方向、查看所有推荐记录。
- 操作：
  - 点击“评奖”打开对话框，可为作品勾选已定义奖项（多选）并即时保存。
  - “X 条推荐”显示所有审阅者推荐（理由+信心度），作为决策参考。
  - 列表标签用颜色区分不同奖项；若仅有“推荐”标签表示还未正式授奖。

## 6. 数据库管理（`/admin/database`）
- 二次密码：首次进入需输入 `admindatabase`（或环境变量 `DATABASE_ADMIN_PASSWORD`），通过后本地会话保持。
- 左侧列出 SQLite 表；顶部按钮可刷新或删除整张表（慎用，操作前有确认提示）。
- 右侧功能：
  - 表格视图：可编辑具有单字段主键的表，每一行支持“保存”和“删除”。
  - “新增记录”按钮：展开表单后可按列填写，点击“创建”即插入。
  - “上传 CSV”按钮：展开区域后选择导入模式（覆盖/后缀）与文件，要求表头与数据库列顺序完全一致；上传成功自动刷新。

> CSV 导入底层使用 `/api/admin/database/tables/{name}/import`，编码需为 UTF-8。覆盖模式会在写入前清空原表。

## 7. 其他事项
- **密码策略**：系统会在用户登录时检测 hash 算法老旧并自动重算，确保兼容 bcrypt/pbkdf2。
- **文件上传**：报销附件与作者海报均在 `data/uploads/`，部署时请记得保留持久化卷或对象存储。
- **调试技巧**：打开浏览器 devtools Network，可看到所有 `/api/admin/*` 请求体，便于定位后台问题。

## 8. 新闻公告管理
- 路由：`/news/manage` 查看自己（或所有）的 Markdown 新闻；`/news/editor/new` / `/news/editor/:slug` 进行在线编辑，内置 Markdown + GFM + 数学公式预览。
- 权限：仅管理员或 `can_publish_news` 用户可访问管理与编辑界面。普通访问 `/news` 列表时会根据 frontmatter `visibility` 自动过滤角色。
- 草稿与发布：frontmatter `published` 字段控制是否对公众可见；管理表格提供“发布/撤回/删除”操作，编辑器默认将新建文章保存为草稿。
- 文件位置：所有新闻以 `.md` 存在 `client/src/assets/posts/`，支持 frontmatter 字段（`title/date/category/tags/summary/visibility/author/published` 等）；后端 `/api/posts/*` 负责读写与权限校验，前端在管理页可直接调用 API 创建或更新 Markdown。

## 9. 审阅者邮箱收集
- 审阅者注册（`/api/reviewers/register`）时需要填写真实邮箱，该邮箱将作为登录账号使用。后台“审阅者邀请码管理”会显示对应姓名与邮箱，方便联系。
- 原 pseudo-email（`{邀请码}@reviewer.local`）方案已废弃，请告知审阅者使用真实邮箱注册。若需要修改已注册审阅者邮箱，可在“用户角色与组织”里直接编辑账号。
- 审阅者注册（`/api/reviewers/register`）时需要填写真实邮箱，该邮箱将作为登录账号使用。邀请码列表中会显示审阅者姓名与邮箱，方便管理员联系。
- 原 pseudo-email（`{邀请码}@reviewer.local`）方案已废弃，请确保发放邀请码时同步告知审阅者使用真实邮箱注册。若需要修改已注册审阅者邮箱，可在“用户角色与组织”中直接编辑。

如需更多技术细节，请参阅 `docs/ARCHITECTURE.md` 与 `backend/app/routers` 下的接口实现。
